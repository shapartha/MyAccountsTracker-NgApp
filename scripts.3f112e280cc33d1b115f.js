var __clientId=getCookie("gapi_clientid"),__apiKey=getCookie("gapi_apikey"),__restApiUrl="https://shapartha-android-zone.000webhostapp.com/accounts-tracker/api/",DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"],SCOPES="https://www.googleapis.com/auth/gmail.readonly",allFilterMappings=[];function handleClientLoad(e){allFilterMappings=e,gapi.load("client:auth2",async function(){await gapi.client.init({apiKey:__apiKey,clientId:__clientId,discoveryDocs:DISCOVERY_DOCS,scope:SCOPES}),gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);var e=await updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());""==getCookie("gapi_gmail_data")&&setCookie("gapi_gmail_data",JSON.stringify(e),3e4)})}function checkSignInStatus(){let e=!1;try{e=gapi.auth2.getAuthInstance().isSignedIn.get()}catch(e){}return e}async function updateSigninStatus(e){return e?await fetchAndProcessMails():void 0}function handleAuthClick(){gapi.auth2.getAuthInstance().signIn()}function handleSignoutClick(){gapi.auth2.getAuthInstance().signOut()}async function fetchAndProcessMails(){var e=allFilterMappings.map(e=>({filterValue:e.filter})),t=[];await new Promise(async(n,a)=>{for(var r=0,o=0;o<e.length;o++){let a=e[o];var s=allFilterMappings.filter(e=>e.filter==a.filterValue)[0],l=s.filter_function;r++;var c=(await gapi.client.gmail.users.messages.list({userId:"me",maxResults:20,labelIds:"INBOX",q:a.filterValue+" after:"+convertDate(datePlusMinus(-40),"yyyy-MM-dd")})).result.messages,u=void 0,d=[];if(!(c&&c.length>0))return{error:"No Messages found."};for(i=0;i<c.length;i++){if(u=c[i].id,null!=s.last_msg_id&&-1!=s.last_msg_id.indexOf(u))continue;const e=await gapi.client.gmail.users.messages.get({userId:"me",id:u,format:"full"});var g=e.result.snippet;let t;"searchForIciciAmazonCC"==l?t=searchForIciciAmazonCC(g,u,a.filterValue):"searchForPayzapp"==l?t=searchForPayzapp(g,u,a.filterValue,e.result.internalDate):"searchForTorrentPower"==l&&(t=searchForTorrentPower(e.result,u,a.filterValue)),null!=t&&null!=t&&d.push(t)}var f={filter:a.filterValue,data:d,menuLevel:"TOP"};t.push(f),r==e.length&&n()}});return t}function searchForTorrentPower(e,t,n){json_object={};var a=e.payload.body,i=e.payload;let r=0;for(;0==a.size&&r<10;)i=i.parts[0],a=i.body,r++;try{a=atob(a.data)}catch(e){console.error(e),a=void 0}if(null!=a&&(a=a.replace(/\r?\n|\r/g," "),["Your Torrent Power bill summary is as below"].forEach(e=>{if(-1!=a.indexOf(e)){var i=a.indexOf("Bill Date");i=a.indexOf("-",i);var r=a.substr(i-2,8),o=r.split("-");r=[o[0],o[1],"20"+o[2]].join("-");var s=a.indexOf("Amount Upto Due Date"),l=a.indexOf("  ",s+"Amount Upto Due Date".length+3),c=a.indexOf("  ",l),u=a.substring(c,a.indexOf("  ",c+3)).trim(),d=a.indexOf("Bill Month"),g=a.indexOf("  ",d+"Bill Month".length+5),f=a.substring(d+"Bill Month".length,g).trim();json_object={trans_amt:u,trans_date:r,trans_type:"DEBIT",trans_desc:("Bill - "+f).replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}})),!isEmpty(json_object))return json_object}function searchForPayzapp(e,t,n,a){let i=convertDate(parseInt(a));json_object={};if(["Your wallet card ending with 6598 has been credited with Rs."].forEach(a=>{var r=e.indexOf(a);if(-1!=r){r+=a.length;var o=e.indexOf(". ",r)-2,s=e.substr(r,o-r+2);json_object={trans_amt:s,trans_date:i,trans_type:"CREDIT",trans_desc:"Cashback".replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}),!isEmpty(json_object))return json_object}function searchForIciciAmazonCC(e,t,n){if(json_object={},["Your ICICI Bank Credit Card XX0005 has been used for a transaction of INR "].forEach(a=>{var i=e.indexOf(a);if(-1!=i){i+=a.length;var r=e.indexOf(" ",i)-1,o=e.substr(i,r-i+1),s=r+5,l=convertDate(e.substr(s,e.indexOf(".",s)-s).replace(";","")),c=e.indexOf("Info: ")+6,u=e.substr(c,e.indexOf(".",c)-c);json_object={trans_amt:o,trans_date:l,trans_type:"DEBIT",trans_desc:u.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}),!isEmpty(json_object))return json_object;return["refund on your ICICI Bank Credit Card XX0005 for INR ","Payment of INR "].forEach(a=>{var i=e.indexOf(a);if(e=e.replace("merchant credit refund on ","merchant credit refund in "),-1!=i){i+=a.length;var r=e.indexOf(" ",i)-1,o=e.substr(i,r-i+1),s=e.indexOf(" on ")+4,l=convertDate(e.substr(s,nthIndexOf(e," ",s,3)-s).replace(".",""));json_object={trans_amt:o,trans_date:l,trans_type:"CREDIT",trans_desc:"Refund / Payment".replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}),isEmpty(json_object)?void 0:json_object}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var i=n[a];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}function setCookie(e,t,n){var a="";if(n){var i=new Date;i.setTime(i.getTime()+n),a="; expires="+i.toUTCString()}document.cookie=e+"="+(t||"")+a+"; path=/"}function nthIndexOf(e,t,n,a){for(var i=1;i<=a;)n=e.indexOf(t,n)+3,i++;return n-3}function isEmpty(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return JSON.stringify(e)===JSON.stringify({})}function padLeadingZero(e){return e<10?"0"+e:e}function convertDate(e,t){var n=new Date;return null!=e&&(n=new Date(e)),null==t&&(t="dd-MM-yyyy HH:mi:ss"),"dd-MM-yyyy HH:mi:ss"==t?[this.padLeadingZero(n.getDate()),this.padLeadingZero(n.getMonth()+1),n.getFullYear()].join("-")+" "+[this.padLeadingZero(n.getHours()),this.padLeadingZero(n.getMinutes()),this.padLeadingZero(n.getSeconds())].join(":"):"yyyy-MM-dd"==t?[n.getFullYear(),this.padLeadingZero(n.getMonth()+1),this.padLeadingZero(n.getDate())].join("-"):e}function datePlusMinus(e){var t=new Date,n=e,a=t.setDate(t.getDate()+n);return new Date(a)}