var __clientId=getCookie("gapi_clientid"),__apiKey=getCookie("gapi_apikey"),__restApiUrl="https://shapartha-android-zone.000webhostapp.com/accounts-tracker/api/",DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"],SCOPES="https://www.googleapis.com/auth/gmail.readonly",allFilterMappings=[];function handleClientLoad(e){allFilterMappings=e,gapi.load("client:auth2",async function(){await gapi.client.init({apiKey:__apiKey,clientId:__clientId,discoveryDocs:DISCOVERY_DOCS,scope:SCOPES}),gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);var e=await updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());""==getCookie("gapi_gmail_data")&&setCookie("gapi_gmail_data",JSON.stringify(e),3e4)})}function checkSignInStatus(){let e=!1;try{e=gapi.auth2.getAuthInstance().isSignedIn.get()}catch(e){}return e}async function updateSigninStatus(e){return e?await fetchAndProcessMails():void 0}function handleAuthClick(){gapi.auth2.getAuthInstance().signIn()}function handleSignoutClick(){gapi.auth2.getAuthInstance().signOut()}async function fetchAndProcessMails(){var e=allFilterMappings.map(e=>({filterValue:e.filter})),t=[];await new Promise(async(n,a)=>{for(var r=0,s=0;s<e.length;s++){let a=e[s];var o=allFilterMappings.filter(e=>e.filter==a.filterValue)[0],l=o.filter_function;r++;var c=(await gapi.client.gmail.users.messages.list({userId:"me",maxResults:20,labelIds:"INBOX",q:a.filterValue+" after:"+convertDate(datePlusMinus(-40),"yyyy-MM-dd")})).result.messages,d=void 0,g=[];if(c&&c.length>0){for(i=0;i<c.length;i++){if(d=c[i].id,null!=o.last_msg_id&&-1!=o.last_msg_id.indexOf(d))continue;const e=await gapi.client.gmail.users.messages.get({userId:"me",id:d,format:"full"});var u=e.result.snippet;let t;"searchForIciciAmazonCC"==l?t=searchForIciciAmazonCC(u,d,a.filterValue):"searchForPayzapp"==l?t=searchForPayzapp(u,d,a.filterValue,e.result.internalDate):"searchForTorrentPower"==l?t=searchForTorrentPower(e.result,d,a.filterValue):"searchForKotakTrans"==l&&(t=searchForKotakTrans(e.result,d,a.filterValue)),null!=t&&null!=t&&g.push(t)}var f={filter:a.filterValue,data:g,menuLevel:"TOP"};t.push(f)}else console.error("No messages found for filter: "+a.filterValue);r==e.length&&n()}});return t}function searchForKotakTrans(e,t,n){json_object={};var a=e.payload.body,r=e.payload;let i=0;for(;0==a.size&&i<10;)r=r.parts[0],a=r.body,i++;try{a=atob(a.data.replace(/-/g,"+").replace(/_/g,"/"))}catch(e){console.error(e),a=void 0}var s=["We wish to inform you that your account xx9871 is debited for Rs. "," has been debited from your Account No. XX9871 on "];null!=a&&(a=a.replace(/\r?\n|\r/g," "),s.forEach(e=>{if(e==s[0]){if(-1!=a.indexOf(e)){var r=a.indexOf(e)+e.length,i=a.indexOf(" ",r),o=a.substring(r,i),l=[(p=(f=a.substring(i+" on ".length)).substring(0,f.indexOf(" ")).split("-"))[0],p[1],"20"+p[2]].join("-"),c=o,d="DEBIT",g=a.substring(a.indexOf("Remarks:</b>")+"Remarks:</b>".length),u=g.substring(0,g.indexOf("<br>")).trim();json_object={trans_amt:c,trans_date:l,trans_type:d,trans_desc:u.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}else if(e==s[1]){let s=a.replace(/(<([^>]+)>)/gi,"");if(-1!=s.indexOf(e)){r=s.indexOf(e),i=s.indexOf("Rs. "),o=s.substring(i+"Rs. ".length,r);var f,p=(f=s.substring(r+e.length)).substring(0,f.indexOf(" ")).split("-");l=convertDate(l=new Date([p[0],p[1],"20"+p[2]].join("-")));c=o.replace(",",""),d="DEBIT",u="Payment Gateway Transaction";json_object={trans_amt:c,trans_date:l,trans_type:d,trans_desc:u.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}}));var o=["We wish to inform you that your account xx9871 is credited by Rs. "," has been credited to your account XX9871 on "];if(null!=a&&(a=a.replace(/\r?\n|\r/g," "),o.forEach(e=>{if(e==o[0]){if(-1!=a.indexOf(e)){var r=a.indexOf(e)+e.length,i=a.indexOf(" ",r),s=a.substring(r,i),l=[(f=(u=a.substring(i+" on ".length)).substring(0,u.indexOf(" ")).split("-"))[0],f[1],"20"+f[2]].join("-"),c=s,d="CREDIT",g="Payment Received";json_object={trans_amt:c,trans_date:l,trans_type:d,trans_desc:g.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}else if(e==o[1]){let o=a.replace(/(<([^>]+)>)/gi,"");if(-1!=o.indexOf(e)){r=o.indexOf(e),i=o.indexOf("Rs. "),s=o.substring(i+"Rs. ".length,r);var u,f=(u=o.substring(r+e.length)).substring(0,u.indexOf(" ")).split("-");l=convertDate(l=new Date([f[0],f[1],"20"+f[2]].join("-")));c=s.replace(",",""),d="CREDIT",g="Payment Received";json_object={trans_amt:c,trans_date:l,trans_type:d,trans_desc:g.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}})),!isEmpty(json_object))return json_object}function searchForTorrentPower(e,t,n){json_object={};var a=e.payload.body,r=e.payload;let i=0;for(;0==a.size&&i<10;)r=r.parts[0],a=r.body,i++;try{a=atob(a.data)}catch(e){console.error(e),a=void 0}if(null!=a&&(a=a.replace(/\r?\n|\r/g," "),["Your Torrent Power bill summary is as below"].forEach(e=>{if(-1!=a.indexOf(e)){var r=a.indexOf("Bill Date");r=a.indexOf("-",r);var i=a.substr(r-2,8),s=i.split("-");i=[s[0],s[1],"20"+s[2]].join("-");var o=a.indexOf("Amount Upto Due Date"),l=a.indexOf("  ",o+"Amount Upto Due Date".length+3),c=a.indexOf("  ",l),d=a.substring(c,a.indexOf("  ",c+3)).trim(),g=a.indexOf("Bill Month"),u=a.indexOf("  ",g+"Bill Month".length+5),f=a.substring(g+"Bill Month".length,u).trim();json_object={trans_amt:d,trans_date:i,trans_type:"DEBIT",trans_desc:("Bill - "+f).replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}})),!isEmpty(json_object))return json_object}function searchForPayzapp(e,t,n,a){let r=convertDate(parseInt(a));json_object={};if(["Your wallet card ending with 6598 has been credited with Rs."].forEach(a=>{var i=e.indexOf(a);if(-1!=i){i+=a.length;var s=e.indexOf(". ",i)-2,o=e.substr(i,s-i+2);json_object={trans_amt:o,trans_date:r,trans_type:"CREDIT",trans_desc:"Cashback".replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}),!isEmpty(json_object))return json_object}function searchForIciciAmazonCC(e,t,n){if(json_object={},["Your ICICI Bank Credit Card XX0005 has been used for a transaction of INR "].forEach(a=>{var r=e.indexOf(a);if(-1!=r){r+=a.length;var i=e.indexOf(" ",r)-1,s=e.substr(r,i-r+1),o=i+5,l=convertDate(e.substr(o,e.indexOf(".",o)-o).replace(";","")),c=e.indexOf("Info: ")+6,d=e.substr(c,e.indexOf(".",c)-c);json_object={trans_amt:s,trans_date:l,trans_type:"DEBIT",trans_desc:d.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}),!isEmpty(json_object))return json_object;return["refund on your ICICI Bank Credit Card XX0005 for INR ","Payment of INR "].forEach(a=>{var r=e.indexOf(a);if(e=e.replace("merchant credit refund on ","merchant credit refund in "),-1!=r){r+=a.length;var i=e.indexOf(" ",r)-1,s=e.substr(r,i-r+1),o=e.indexOf(" on ")+4,l=convertDate(e.substr(o,nthIndexOf(e," ",o,3)-o).replace(".",""));json_object={trans_amt:s,trans_date:l,trans_type:"CREDIT",trans_desc:"Refund / Payment".replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}),isEmpty(json_object)?void 0:json_object}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),a=0;a<n.length;a++){for(var r=n[a];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}function setCookie(e,t,n){var a="";if(n){var r=new Date;r.setTime(r.getTime()+n),a="; expires="+r.toUTCString()}document.cookie=e+"="+(t||"")+a+"; path=/"}function nthIndexOf(e,t,n,a){for(var r=1;r<=a;)n=e.indexOf(t,n)+3,r++;return n-3}function isEmpty(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return JSON.stringify(e)===JSON.stringify({})}function padLeadingZero(e){return e<10?"0"+e:e}function convertDate(e,t){var n=new Date;return null!=e&&(n=new Date(e)),null==t&&(t="dd-MM-yyyy HH:mi:ss"),"dd-MM-yyyy HH:mi:ss"==t?[this.padLeadingZero(n.getDate()),this.padLeadingZero(n.getMonth()+1),n.getFullYear()].join("-")+" "+[this.padLeadingZero(n.getHours()),this.padLeadingZero(n.getMinutes()),this.padLeadingZero(n.getSeconds())].join(":"):"yyyy-MM-dd"==t?[n.getFullYear(),this.padLeadingZero(n.getMonth()+1),this.padLeadingZero(n.getDate())].join("-"):e}function datePlusMinus(e){var t=new Date,n=e,a=t.setDate(t.getDate()+n);return new Date(a)}