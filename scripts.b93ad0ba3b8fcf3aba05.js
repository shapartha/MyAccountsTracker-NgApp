var __clientId=getCookie("gapi_clientid"),__apiKey=getCookie("gapi_apikey"),__restApiUrl="https://redirection-root-4755utlstq-el.a.run.app/",DISCOVERY_DOCS=["https://www.googleapis.com/discovery/v1/apis/gmail/v1/rest"],SCOPES="https://www.googleapis.com/auth/gmail.readonly",allFilterMappings=[],__debitConditions=[],__creditConditions=[];function handleClientLoad(e){allFilterMappings=e,gapi.load("client:auth2",async function(){await gapi.client.init({apiKey:__apiKey,clientId:__clientId,discoveryDocs:DISCOVERY_DOCS,scope:SCOPES}),gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);var e=await updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());null==getSessionStorageData("gapi_gmail_data")&&setSessionStorageData("gapi_gmail_data",JSON.stringify(e))})}function checkSignInStatus(){let e=!1;try{e=gapi.auth2.getAuthInstance().isSignedIn.get()}catch(e){}return e}async function updateSigninStatus(e){return e?await fetchAndProcessMails():void 0}function handleAuthClick(){gapi.auth2.getAuthInstance().signIn()}function handleSignoutClick(){gapi.auth2.getAuthInstance().signOut()}async function fetchAndProcessMails(){var e=allFilterMappings.map(e=>({filterValue:e.filter,accId:e.acc_id,debitConditions:e.debit_conditions_json,creditConditions:e.credit_conditions_json})),t=[];await new Promise(async(n,r)=>{var a=0;let s=[];for(var o="",l=0;l<e.length;l++){let r=e[l];var d=allFilterMappings.filter(e=>e.filter==r.filterValue&&e.acc_id==r.accId)[0],c=d.filter_function;o+=","+d.last_msg_id,a++;let O=s.filter(e=>e.filter==r.filterValue),m=null;if(null==O||0==O.length){try{m=await gapi.client.gmail.users.messages.list({userId:"me",maxResults:20,labelIds:"INBOX",q:r.filterValue+" after:"+convertDate(datePlusMinus(-40),"yyyy-MM-dd")})}catch(e){console.error(e);continue}s.push({filter:r.filterValue,resp:m})}else m=O[0].resp;var g=m.result.messages,f=void 0,u=[];if(g&&g.length>0){for(i=0;i<g.length;i++){if(f=g[i].id,null!=d.last_msg_id&&-1!=d.last_msg_id.indexOf(f)&&-1!=o.indexOf(f))continue;const e=await gapi.client.gmail.users.messages.get({userId:"me",id:f,format:"full"});var _=e.result.snippet;let t;var p=e.result.payload.headers.filter(e=>"Received"===e.name)[0].value;p=convertDate(p=p.split(";")[1]),__debitConditions=JSON.parse(r.debitConditions),__creditConditions=JSON.parse(r.creditConditions),"searchForIciciAmazonCC"==c?t=searchForIciciAmazonCC(_,f,r.filterValue):"searchForPayzapp"==c?t=searchForPayzapp(_,f,r.filterValue,e.result.internalDate):"searchForTorrentPower"==c?t=searchForTorrentPower(e.result,f,r.filterValue):"searchForKotakTrans"==c?t=searchForKotakTrans(e.result,f,r.filterValue):"searchForHdfcTrans"==c?t=searchForHdfcTrans(e.result,f,r.filterValue):"searchForZeta"==c&&(t=searchForZeta(_,f,r.filterValue,p)),null!=t&&null!=t&&(u.push(t),o+=","+f)}var h={filter:r.filterValue,data:u,accId:r.accId,menuLevel:"TOP"};t.push(h)}else console.info("No messages found for filter: "+r.filterValue);a==e.length&&n()}});return t}function searchForKotakTrans(e,t,n){json_object={};var i=e.payload.body,r=e.payload;let a=0;for(;0==i.size&&a<10;)r=r.parts[0],i=r.body,a++;try{i=atob(i.data.replace(/-/g,"+").replace(/_/g,"/"))}catch(e){console.error(e),i=void 0}var s=__debitConditions;null!=i&&(i=i.replace(/\r?\n|\r/g," "),s.forEach(e=>{if(e==s[0]){if(-1!=i.indexOf(e)){var r=i.indexOf(e)+e.length,a=i.indexOf(" ",r),o=i.substring(r,a),l=[(_=(u=i.substring(a+" on ".length)).substring(0,u.indexOf(" ")).split("-"))[0],_[1],"20"+_[2]].join("-"),d=o,c="DEBIT",g=i.substring(i.indexOf("Remarks:</b>")+"Remarks:</b>".length),f=g.substring(0,g.indexOf("<br>")).trim();json_object={trans_amt:d,trans_date:l,trans_type:c,trans_desc:f.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}else if(e==s[1]){let s=i.replace(/(<([^>]+)>)/gi,"");if(-1!=s.indexOf(e)){r=s.indexOf(e),a=s.indexOf("Rs. "),o=s.substring(a+"Rs. ".length,r);var u,_=(u=s.substring(r+e.length)).substring(0,u.indexOf(" ")).split("-");l=convertDate(l=new Date([_[0],_[1],"20"+_[2]].join("-")));d=o.replace(",",""),c="DEBIT",f="Payment Gateway Transaction";json_object={trans_amt:d,trans_date:l,trans_type:c,trans_desc:f.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}}));var o=__creditConditions;if(null!=i&&(i=i.replace(/\r?\n|\r/g," "),o.forEach(e=>{if(e==o[0]){if(-1!=i.indexOf(e)){var r=i.indexOf(e)+e.length,a=i.indexOf(" ",r),s=i.substring(r,a),l=(f=i.substring(a+" on ".length)).substring(0,f.indexOf(" "));u=convertDate(u=new Date(l));var d=s,c="CREDIT",g="Payment Received";json_object={trans_amt:d,trans_date:u,trans_type:c,trans_desc:g.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}else if(e==o[1]){let o=i.replace(/(<([^>]+)>)/gi,"");if(-1!=o.indexOf(e)){r=o.indexOf(e),a=o.indexOf("Rs. "),s=o.substring(a+"Rs. ".length,r);var f,u,_=(l=(f=o.substring(r+e.length)).substring(0,f.indexOf(" "))).split("-");u=convertDate(u=new Date([_[0],_[1],"20"+_[2]].join("-")));d=s.replace(",",""),c="CREDIT",g="Payment Received";json_object={trans_amt:d,trans_date:u,trans_type:c,trans_desc:g.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}})),!isEmpty(json_object))return json_object}function searchForHdfcTrans(e,t,n){json_object={};var i=e.payload.body,r=e.payload;let a=0;for(;0==i.size&&a<10;)r=r.parts[0],i=r.body,a++;try{i=atob(i.data.replace(/-/g,"+").replace(/_/g,"/"))}catch(e){console.error(e),i=void 0}let s=!1;var o=__debitConditions;if(null!=i){let e="Do not share your internet banking username/password or Credit/ Debit Card number/ CVV/ OTP via e-mail or over the phone. HDFC Bank will never ask for it";i=(i=(i=(i=i.replace(/\r?\n|\r/g," ")).replace(/(<([^>]+)>)/gi,"")).substring(0,i.indexOf(e))).replaceAll("on account of","onaccountof"),o.forEach(e=>{if(-1!=i.indexOf(e)){s=!0;let e=-1,l=0;-1!=i.indexOf("Rs. ")?(e=i.indexOf("Rs. "),l=4):-1!=i.indexOf("Rs.")?(e=i.indexOf("Rs."),l=3):-1!=i.indexOf("Rs ")?(e=i.indexOf("Rs "),l=3):-1!=i.indexOf("Rs")?(e=i.indexOf("Rs"),l=2):-1!=i.indexOf("INR ")?(e=i.indexOf("INR "),l=4):-1!=i.indexOf("INR")&&(e=i.indexOf("INR"),l=3);var r=i.substring(e+l,i.indexOf(" ",e+l));let d=i.indexOf(" on ")+4;var a=i.substring(d,i.indexOf(".",d));a.length>12&&(a=a.substring(0,a.indexOf(" ")));let c=a.split("-"),g=c[2];g=2==g.length?"20"+g:g;var o=convertDate([g,c[1],c[0]].join("-"),"yyyy-MM-dd");json_object={trans_amt:r.replaceAll(",",""),trans_date:o,trans_type:"DEBIT",trans_desc:"Enter transaction description",google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}})}if(1!=s){var l=__creditConditions;null!=i&&(i=(i=i.replace(/\r?\n|\r/g," ")).replace(/(<([^>]+)>)/gi,""),l.forEach(e=>{if(-1!=i.indexOf(e)){let e=-1,o=0;-1!=i.indexOf("Rs. ")?(e=i.indexOf("Rs. "),o=4):-1!=i.indexOf("Rs.")?(e=i.indexOf("Rs."),o=3):-1!=i.indexOf("Rs ")?(e=i.indexOf("Rs "),o=3):-1!=i.indexOf("Rs")?(e=i.indexOf("Rs"),o=2):-1!=i.indexOf("INR ")?(e=i.indexOf("INR "),o=4):-1!=i.indexOf("INR")&&(e=i.indexOf("INR"),o=3);var r=i.substring(e+o,i.indexOf(" ",e+o));let l=i.indexOf(" on ")+4;var a=i.substring(l,i.indexOf(".",l));a.length>12&&(a=a.substring(0,a.indexOf(" ")));let d=a.split("-"),c=d[2];c=2==c.length?"20"+c:c;var s=convertDate([c,d[1],d[0]].join("-"),"yyyy-MM-dd");json_object={trans_amt:r.replaceAll(",",""),trans_date:s,trans_type:"CREDIT",trans_desc:"Enter transaction description",google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}))}if(!isEmpty(json_object))return json_object}function searchForTorrentPower(e,t,n){json_object={};var i=__debitConditions,r=__creditConditions,a=e.payload.body,s=e.payload,o=s.headers.filter(e=>"Received"===e.name)[0].value;o=convertDate(o=o.split(";")[1]);let l=0;for(;0==a.size&&l<10;)s=s.parts[0],a=s.body,l++;try{a=atob(a.data)}catch(e){console.error(e),a=void 0}if(null!=a&&(a=a.replace(/\r?\n|\r/g," "),i.forEach(e=>{if(-1!=a.indexOf(e)){var i=a.indexOf("Bill Date");i=a.indexOf("-",i);var r=a.substr(i-2,8),s=r.split("-");r=[s[0],s[1],"20"+s[2]].join("-");var o=a.indexOf("Amount Upto Due Date"),l=a.indexOf("  ",o+"Amount Upto Due Date".length+3),d=a.indexOf("  ",l),c=a.substring(d,a.indexOf("  ",d+3)).trim(),g=a.indexOf("Bill Month"),f=a.indexOf("  ",g+"Bill Month".length+5),u=a.substring(g+"Bill Month".length,f).trim();json_object={trans_amt:c,trans_date:r,trans_type:"DEBIT",trans_desc:("Bill - "+u).replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}),r.forEach(e=>{var i=a.indexOf(e);if(-1!=i){var r=a.indexOf(" made online towards service number",i+e.length+4),s=a.substring(i+e.length+4,r);json_object={trans_amt:s,trans_date:o,trans_type:"CREDIT",trans_desc:"Electricity Bill Payment",google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}})),!isEmpty(json_object))return json_object}function searchForPayzapp(e,t,n,i){let r=convertDate(parseInt(i));if(json_object={},__creditConditions.forEach(i=>{var a=e.indexOf(i);if(-1!=a){a+=i.length;var s=e.indexOf(". ",a)-2,o=e.substr(a,s-a+2);json_object={trans_amt:o,trans_date:r,trans_type:"CREDIT",trans_desc:"Cashback".replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}),!isEmpty(json_object))return json_object}function searchForIciciAmazonCC(e,t,n){return json_object={},__debitConditions.forEach(i=>{var r=e.indexOf(i);if(-1!=r){r+=i.length;var a=e.indexOf(" ",r)-1,s=e.substr(r,a-r+1),o=a+5,l=convertDate(e.substr(o,e.indexOf(".",o)-o).replace(" at","")),d=e.indexOf("Info: ")+6,c=e.substr(d,e.indexOf(".",d)-d);json_object={trans_amt:s,trans_date:l,trans_type:"DEBIT",trans_desc:c.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}),isEmpty(json_object)?(__creditConditions.forEach(i=>{var r=e.indexOf(i);if(e=e.replace("merchant credit refund on ","merchant credit refund in "),-1!=r){r+=i.length;var a=e.indexOf(" ",r)-1,s=e.substr(r,a-r+1);isNaN(parseFloat(s))&&(a=e.indexOf("INR ")+4,s=e.substring(a,e.indexOf(" ",a)));var o=e.indexOf(" on ")+4,l=convertDate(e.substr(o,nthIndexOf(e," ",o,3)-o).replace(".",""));json_object={trans_amt:s,trans_date:l,trans_type:"CREDIT",trans_desc:"Refund / Payment".replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}}),isEmpty(json_object)?void 0:json_object):json_object}function searchForZeta(e,t,n,i){e=e.replaceAll("&#39;","'"),console.log(e),console.log(t),__debitConditions.forEach(r=>{var a=e.indexOf(r);if(-1!=a){a+=r.length;var s=e.indexOf(" ",a)-1,o=e.substr(a+1,s-a+1),l=i,d=e.indexOf(" at ",s),c=e.substr(d+4,e.indexOf(".",d)-d-4);json_object={trans_amt:o,trans_date:l,trans_type:"DEBIT",trans_desc:c.replace("\\",""),google_msg_id:t,google_filter:n,menuLevel:"MAIN"}}});if(!isEmpty(json_object))return json_object}function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var r=n[i];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}function setCookie(e,t,n){var i="";if(n){var r=new Date;r.setTime(r.getTime()+n),i="; expires="+r.toUTCString()}document.cookie=e+"="+(t||"")+i+"; path=/"}function getSessionStorageData(e){return sessionStorage.getItem(e)}function setSessionStorageData(e,t){return sessionStorage.setItem(e,t)}function nthIndexOf(e,t,n,i){for(var r=1;r<=i;)n=e.indexOf(t,n)+3,r++;return n-3}function isEmpty(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return JSON.stringify(e)===JSON.stringify({})}function padLeadingZero(e){return e<10?"0"+e:e}function convertDate(e,t){var n=new Date;return null!=e&&(n=new Date(e)),null==t&&(t="dd-MM-yyyy HH:mi:ss"),"dd-MM-yyyy HH:mi:ss"==t?[this.padLeadingZero(n.getDate()),this.padLeadingZero(n.getMonth()+1),n.getFullYear()].join("-")+" "+[this.padLeadingZero(n.getHours()),this.padLeadingZero(n.getMinutes()),this.padLeadingZero(n.getSeconds())].join(":"):"yyyy-MM-dd"==t?[n.getFullYear(),this.padLeadingZero(n.getMonth()+1),this.padLeadingZero(n.getDate())].join("-"):e}function datePlusMinus(e){var t=new Date,n=e,i=t.setDate(t.getDate()+n);return new Date(i)}